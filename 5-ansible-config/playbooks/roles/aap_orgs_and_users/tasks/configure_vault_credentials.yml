# ---
- name: create/update AAP Credential with new Vault Secret ID
  ansible.controller.credential:
    controller_host: "{{ aap_url }}"                    # URL of your AAP instance
    controller_username: "admin"                        # AAP username
    controller_password: "{{ aap_password }}"           # AAP password
    name: "hashicorp_vault_ssh_signed"                  # Name of the credential
    description: "Credential for HashiCorp Vault AppRole integration"
    organization: "{{ item.name }}"                     # Organization name in AAP
    credential_type: "HashiCorp Vault Signed SSH"       # Type of the credential
    state: present                                      # Ensures the credential is updated or created if absent
    inputs:                                             # All required fields for this credential type
      url: "{{ vault_url }}"                            # Server URL (VAULT_ADDR)
      cacert: ""                     # CA Certificate if applicable
      role_id: ""                    # Vault AppRole role_id
      secret_id: ""                # Vault AppRole secret_id
      default_auth_path: "approle"                      # Path to the Vault AppRole auth method
      namespace: "{{ item.name }}"                      # Vault namespace if applicable
    validate_certs: false                               # Skip SSL verification if using self-signed certs
  loop: "{{ aap_organizations }}"
  register: vault_credentials

- name: Display Credential Status
  debug:
    msg: "Credential update response: {{ vault_credentials }}"